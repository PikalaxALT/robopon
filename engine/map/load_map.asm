MACRO macro_841d
	db (\1 << 3) | \2
	ENDM

Data_841d: ; 841d
	macro_841d  4, 5
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 10, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 7
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 17, 4
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 12, 7
	macro_841d  7, 5
	macro_841d  7, 5
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 11, 7
	macro_841d  6, 6
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 16, 0
	macro_841d  9, 6
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d  6, 5
	macro_841d  6, 6
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d  6, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 11, 0
	macro_841d  2, 3
	macro_841d  1, 6
	macro_841d  1, 7
	macro_841d  1, 4
	macro_841d  1, 4
	macro_841d  0, 5
	macro_841d  0, 4
	macro_841d  0, 2
	macro_841d  0, 4
	macro_841d  0, 4
	macro_841d  0, 4
	macro_841d  0, 4
	macro_841d  0, 4
	macro_841d  0, 4
	macro_841d  0, 4
	macro_841d  0, 4
	macro_841d  0, 4
	macro_841d  4, 2
	macro_841d  9, 7
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d  5, 6
	macro_841d  5, 0
	macro_841d  5, 0
	macro_841d  5, 6
	macro_841d  5, 0
	macro_841d  5, 0
	macro_841d  5, 0
	macro_841d  5, 7
	macro_841d  5, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d  2, 5
	macro_841d 11, 4
	macro_841d  2, 3
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d 16, 0
	macro_841d  4, 5
	macro_841d 11, 4
	macro_841d  1, 5
	macro_841d  4, 5
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d  3, 1
	macro_841d  3, 1
	macro_841d 13, 3
	macro_841d 13, 3
	macro_841d 13, 3
	macro_841d 13, 3
	macro_841d 13, 1
	macro_841d 13, 1
	macro_841d  8, 1
	macro_841d  6, 6
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d  4, 6
	macro_841d  9, 3
	macro_841d  7, 5
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 0
	macro_841d 13, 7
	macro_841d 13, 7
	macro_841d 13, 7
	macro_841d 13, 7
	macro_841d 13, 7
	macro_841d 11, 4
	macro_841d 13, 7
	macro_841d 13, 7
	macro_841d 13, 7
	macro_841d 13, 7
	macro_841d  1, 0
	macro_841d  1, 0
	macro_841d  1, 0
	macro_841d  1, 0
	macro_841d  8, 4
	macro_841d  8, 4
	macro_841d  8, 4
	macro_841d  8, 4
	macro_841d  8, 4
	macro_841d  8, 4
	macro_841d  8, 4
	macro_841d  8, 4
	macro_841d  8, 4
	macro_841d  8, 4
	macro_841d  9, 3
	macro_841d  4, 2
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 11, 4
	macro_841d 18, 4
	macro_841d 12, 4
	macro_841d 14, 4
	macro_841d 15, 4
	macro_841d 11, 4
	macro_841d  4, 2
	macro_841d  4, 5

Data_84f1: ; 84f1
	db $0f, $00, $00, $15, $2f, $0a, $0f, $3e

Data_84f9: ; 84f9
	map MAP_00_15
	map MAP_01_00
	map MAP_02_00
	map MAP_03_00
	map MAP_03_11
	map MAP_03_13
	map MAP_03_14
	map MAP_03_15
	map MAP_05_32
	map MAP_08_01
	map MAP_11_00
	map MAP_12_00
	map MAP_18_14
	map MAP_18_17
	map MAP_19_02
	map MAP_19_03
	map MAP_19_10
	map MAP_19_11
	map MAP_19_20
	map MAP_19_22
	map MAP_19_33
	map MAP_19_40
	map MAP_21_12
	map MAP_21_23
	map MAP_22_00
	map MAP_22_01
	map MAP_24_00
	map MAP_25_00
	map MAP_25_01
	map MAP_26_00
	map MAP_27_00
	map MAP_27_04
	map MAP_27_05
	map MAP_27_06
	map MAP_27_07
	map MAP_27_08
	map MAP_27_10
	map MAP_28_00
	map MAP_29_01
	map MAP_29_30
	map MAP_32_11

PreloadNextMap: ; 854b (2:454b)
; a = map group
; e = map number
; c = flag
MACRO del
	read_hl_from \1
	call free_Bank02
	ld hl, $0
	write_hl_to \1
	ENDM
	
	push af
	push de
	add sp, -$62

	push bc
	ld hl, sp+$55
	reg16swap de, hl
	ld hl, Data_84f1
	ld bc, $8
	call MemCopy

	ld hl, sp+$3
	reg16swap de, hl
	ld hl, Data_84f9
	ld bc, $52
	call MemCopy
	xor a
	ld [wc7a5], a
	pop bc

	push bc
	inc c
	dec c
	jp nz, .c_not_zero
	ld hl, $0
	write_hl_to wc85d
	ld hl, $0
	write_hl_to wMapCollisionPointer
	write_hl_to wc82e
	write_hl_to wc82c
	write_hl_to wBlockdataPointer
	write_hl_to wc826
	write_hl_to wLoadAttrsSourcePointer
	write_hl_to wc824
	ld hl, $0
	write_hl_to wWarpDataPointer
	ld hl, $0
	write_hl_to wNPCMovementDataPointer
	ld hl, $0
	write_hl_to wObjectStructPointer
	ld hl, $0
	write_hl_to wc776
	ld hl, $0
	write_hl_to wPlayerSpritePointer
	xor a
	ld [wPlayerSpriteYOffset], a
	ld [wPlayerSpriteXOffset], a
	ld [wPlayerSpriteNotCenteredOnScreen], a
	ld a, $1
	ld [wRemainInMap], a
	jp .okay

.c_not_zero
	del wc824
	del wLoadAttrsSourcePointer
	del wc826
	del wBlockdataPointer
	del wc82c
	del wc82e
	del wPlayerSpritePointer
	del wc85d
.okay
	set_farcall_addrs_hli GroupAndNumberToLinearIndex
	ld hl, sp+$64
	ld e, [hl]
	ld hl, sp+$67
	ld a, [hl]
	call FarCall
	ld a, l
	ld hl, sp+$5d
	ld [hl], a
	ld hl, $200
	call malloc_Bank02
	write_hl_to wc824
	ld hl, $200
	call malloc_Bank02
	write_hl_to wLoadAttrsSourcePointer
	ld hl, $80
	call malloc_Bank02
	write_hl_to wc826
	ld hl, $80
	call malloc_Bank02
	write_hl_to wc844
	ld hl, $e0
	call malloc_Bank02
	write_hl_to wc85d
	ld hl, sp+$5d
	ld e, [hl]
	ld d, $0
	ld hl, Data_841d
	add hl, de
	ld a, [hl]
	and $7
	ld e, a
	ld d, $0
	ld hl, sp+$55
	add hl, de
	ld a, [hl]
	ld [wc859], a
	ld hl, sp+$5d
	ld a, [hl]
	call LoadBlockData
	ld a, BANK(Pointers_1c000)
	ld [wFarCallDestBank], a
	ld bc, $3
	ld hl, sp+$5d
	ld e, [hl]
	ld d, $0
	ld hl, Data_841d
	add hl, de
	ld a, [hl]
	and $7
	ld l, a
	ld h, $0
	ld e, l
	ld d, h
	add hl, hl
	add hl, de
	ld de, Pointers_1c000
	add hl, de
	reg16swap de, hl
	ld hl, sp+$5e
	call FarCopyVideoData
	ld hl, $728
	push hl
	call malloc_Bank02
	write_hl_to wTilesetPointer
	ld hl, sp+$60
	ld a, [hl]
	add BANK(Pointers_1c000)
	ld [wFarCallDestBank], a
	pop bc
	read_hl_from wTilesetPointer
	push hl
	read_hl_from_sp_plus $63
	pop de
	call FarDecompressVideoData
	read_hl_from wTilesetPointer
	ld de, $2a8
	add hl, de
	reg16swap de, hl
	ld hl, $400
	add hl, de
	push hl
	ld hl, $154
	call malloc_Bank02
	write_hl_to wc842
	ld bc, $154
	ld e, $ff
	read_hl_from wc842
	call FillMemory
	ld a, [wc7da]
	or a
	jp nz, Func_8752
	call Func_b6f2
	xor a
	call Func_bbc8
	jp Func_875d

Func_8752: ; 8752 (2:4752)
	ld e, $ff
	ld a, $ff
	call Func_b60d
	xor a
	call Func_bbc8
Func_875d: ; 875d (2:475d)
	ld a, $ff
	ld [wc81f], a
	ld hl, sp+$4
	ld [hl], $ff
	ld bc, $0
Func_8769: ; 8769 (2:4769)
	ld l, c
	ld h, b
	ld de, $52
	call CompareHLtoDE
	jp nc, Func_87b9
	ld hl, sp+$69
	ld a, [hl]
	ld hl, sp+$5
	add hl, bc
	cp [hl]
	jp nz, Func_87b4
	ld hl, sp+$66
	ld a, [hl]
	ld hl, sp+$6
	add hl, bc
	cp [hl]
	jp nz, Func_87b4
	ld hl, sp+$5f
	ld e, [hl]
	ld d, $0
	ld hl, Data_841d
	add hl, de
	ld a, [hl]
	and $7
	cp $4
	jp z, Func_87a0
	ld hl, sp+$4
	ld [hl], $7
	jp Func_87a4

Func_87a0: ; 87a0 (2:47a0)
	ld hl, sp+$4
	ld [hl], $27
Func_87a4: ; 87a4 (2:47a4)
	ld hl, sp+$4
	ld e, [hl]
	ld d, $0
	read_hl_from wc844
	add hl, de
	ld [hl], $1
	jp Func_87b9

Func_87b4: ; 87b4 (2:47b4)
	inc bc
	inc bc
	jp Func_8769

Func_87b9: ; 87b9 (2:47b9)
	call LoadMapTiles
	ld hl, sp+$4
	ld a, [hl]
	cp $ff
	jp z, Func_87ca
	ld hl, sp+$4
	ld a, [hl]
	call Func_a184
Func_87ca: ; 87ca (2:47ca)
	pop de
	read_hl_from wc826
	ld bc, $80
	call CopyFromDEtoHL
	read_hl_from wc842
	call free_Bank02
	read_hl_from wc844
	call free_Bank02
	read_hl_from wTilesetPointer
	call free_Bank02
	pop bc
	push bc
	inc c
	dec c
	jp nz, Func_8827
	ld hl, wMapWidth
	ld l, [hl]
	ld h, $0
	ld a, [wMapHeight]
	ld e, a
	ld d, $0
	call MultiplyHLbyDE
	call malloc_Bank02
	write_hl_to wMapCollisionPointer
	ld hl, wMapWidth
	ld l, [hl]
	ld h, $0
	ld a, [wMapHeight]
	ld e, a
	ld d, $0
	call MultiplyHLbyDE
	ld c, l
	ld b, h
	ld e, $0
	read_hl_from wMapCollisionPointer
	call FillMemory
Func_8827: ; 8827 (2:4827)
	ld a, [wSpawnY]
	ld e, a
	ld a, [wSpawnX]
	call SpawnPlayerAt
	xor a
	call LoadPlayerSprite
	ld hl, sp+$5d
	ld e, [hl]
	ld d, $0
	ld hl, Data_841d
	add hl, de
	ld a, [hl]
	ld b, $8
	call DivideAbyB
	ld [wc867], a
	xor a
	ld [wc837], a
	ld [wc836], a
	ld [wc835], a
	ld [wc834], a
	ld [wc833], a
	ld [wc832], a
	ld [wCurrentDirectionalInputHeldFramesCounter], a
	xor a
	ld [wc83a], a
	xor a
	ld [wSliding], a
	pop bc
	push bc
	inc c
	dec c
	jp nz, .dont_delete
	call AllocateSpaceForMapObjects
	call Func_aff1
	call AllocateSpaceForWarps
	call Func_b773
	call ClearMovementPointer
	call AbortShakingScreen
	call Func_bf2c
	ld a, $ff
	call Func_bf46
	callba_hli Func_9b251
.dont_delete
	ld a, $1
	call Func_b52c
	callba_hli Func_da07a
	ld hl, sp+$5e
	ld [hl], $40
	ld hl, sp+$5f
	ld [hl], $0
	set_farcall_addrs_hli Func_d9f74
	ld hl, sp+$5e
	call FarCall
	callba_hli Func_da4fc
	read_hl_from wc82e
	ld a, l
	or h
	jp z, Func_88df
	read_hl_from wc82e
	call free_Bank02
Func_88df: ; 88df (2:48df)
	pop bc
	ld a, c
	cp $1
	jp nz, Func_88f8
	ld a, $ff
	ld [wLastPlayerFacing], a
	ld c, $0
	ld e, $0
	ld a, [wPlayerFacing]
	call UpdateSprites
	call NextOverworldFrame
Func_88f8: ; 88f8 (2:48f8)
	ld a, [wSpawnPushY]
	ld l, a
	push hl
	ld a, [wSpawnPushX]
	ld c, a
	ld a, [wSpawnY]
	ld e, a
	ld a, [wSpawnX]
	call GetSpawnFacing
	pop bc
	ld [wPlayerFacing], a
	ld a, [wPlayerFacing]
	cp $ff
	jp nz, Func_891c
	ld a, $2
	ld [wPlayerFacing], a
Func_891c: ; 891c (2:491c)
	call GetPlayerSprite
	call Bank2_WaitVideoTransferIfLCDEnabled
	ld hl, wMapWidth
	ld l, [hl]
	ld h, $0
	add hl, hl
	ld e, l
	ld d, h
	add hl, hl
	add hl, de
	ld a, l
	cpl
	ld l, a
	ld a, h
	cpl
	ld h, a
	inc hl
	ld de, -6
	add hl, de
	write_hl_to wc868
	ld hl, wMapWidth
	ld l, [hl]
	ld h, $0
	add hl, hl
	ld e, l
	ld d, h
	add hl, hl
	add hl, de
	ld de, -6
	add hl, de
	write_hl_to wc86e
	ld hl, wMapWidth
	ld l, [hl]
	ld h, $0
	ld e, l
	ld d, h
	add hl, hl
	add hl, hl
	add hl, de
	ld a, l
	cpl
	ld l, a
	ld a, h
	cpl
	ld h, a
	inc hl
	ld de, -7
	add hl, de
	write_hl_to wc86c
	ld hl, wMapWidth
	ld l, [hl]
	ld h, $0
	ld e, l
	ld d, h
	add hl, hl
	add hl, hl
	add hl, de
	ld a, l
	cpl
	ld l, a
	ld a, h
	cpl
	ld h, a
	inc hl
	ld de, $6
	add hl, de
	write_hl_to wc86a
	add sp, $66
	ret
